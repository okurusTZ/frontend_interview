#### 为什么会跨域

浏览器同源策略导致了跨域，同源策略限制了从同一个源加载的文档或者脚本如何与来自另一个源的资源进行交互。是一个隔离潜在恶意文件的重要安全机制。

#### CSRF攻击（cross-site request forgery）

攻击者盗用你的身份，以你的名义发送恶意请求。

##### 原理

1. 登录受信任网站A，并在本地生成Cookie
2. 在不登出A的情况下，访问危险站点B

##### 具体步骤

1. 浏览登录受信任网站A
2. 验证通过，在用户处产生A的Cookie
3. 用户在没有登出A的情况下，访问危险站点B
4. B要求访问第三方站点A，发出一个请求
5. 根据B的请求，浏览器带着先前产生的Cookie访问
6. A不知道请求是用户发出的还是B发出的，由于浏览器自动带上用户的Cookie，所以A根据用户的权限处理的请求，B达到了模拟用户操作的目的。

##### 防御

1. 服务端进行防御
   * 在客户端页面增加伪随机数`Cookie.hashing()`等，使攻击者不能获得第三方的cookie
   * 验证码，每次提交时在表单中填写验证码
   * One-Time Tokens

#### XSS攻击

跨站脚本攻击。在web页面中插入一些恶意的script代码，当用户浏览页面的时候，嵌入到页面中的代码会执行，达到恶意攻击用户的目的。

1. 反射型：用户点击攻击连接，服务器解析后响应，返回的内容中出现XSS代码，浏览器执行。XSS脚本是被web server反射回来给浏览器执行的
2. 存储型：把恶意代码上传或存储到服务器，只要受害者浏览包含此代码的页面就会执行
3. DOM-BASED：包含恶意的js脚本，通过js取出url中的恶意代码并执行。web server不参与，仅仅涉及到浏览器。根据用户输入动态构造一个DOM节点，如果没有过滤，就会导致XSS攻击的产生。

##### XSS的防御

**对输入进行过滤，对输出进行编码**。对提交的所有内容进行过滤，对url的参数进行过滤，过滤掉会导致脚本执行的相关内容。对动态输出到页面的内容进行html编码，导致脚本无法在浏览器中执行。

#### 同源策略限制下接口请求的正确打开方式

1. JSONP
   * 核心思想： 浏览器的script、img、iframe标签不受同源策略限制，所以通过script标签引入一个js文件，这个js文件加载成功后会执行我们在url参数中指定的callback函数，并把我们需要的json数据作为参数传入。在服务器端，当req.params参数中带callback属性时，则把数据作为callback的参数执行，拼接成一个字符串后返回。
2. CORS
   * 核心思想：在服务器端检查请求头部的origin，决定请求失败还是成功。在服务端设置response header响应头中的access-control-allow-origin为对应的域名。
3. 

